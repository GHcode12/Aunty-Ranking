<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aunty Ranking</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --bg: #fdf6e3; --accent: #ffd700; --text: #2b2b2b; --border: #000; --red: #d32f2f; }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        /* Neubrutalist Components */
        .brutalist-card { 
            background: white; border: 4px solid var(--border); padding: 1.5rem; 
            box-shadow: 8px 8px 0px var(--border); margin-bottom: 25px;
        }
        header { text-align: center; background: var(--accent); padding: 1.5rem; border: 4px solid var(--border); box-shadow: 10px 10px 0px var(--border); margin-bottom: 3rem; }
        
        .btn { 
            background: var(--accent); border: 3px solid var(--border); padding: 10px 20px; 
            font-weight: 800; cursor: pointer; box-shadow: 4px 4px 0px var(--border); display: inline-block; text-decoration: none; color: black;
        }
        .btn:active { transform: translate(2px, 2px); box-shadow: 0px 0px 0px var(--border); }
        .btn-back { background: #fff; margin-bottom: 20px; }

        /* Navigation Logic */
        .page { display: none; max-width: 800px; margin: 0 auto; }
        .page.active { display: block; }

        .flex-row { display: flex; justify-content: space-between; align-items: center; }
        .tag { background: var(--red); color: white; padding: 4px 8px; font-weight: bold; font-size: 0.8rem; text-transform: uppercase; }
        #loading-text { text-align: center; font-weight: bold; margin-bottom: 10px; }
    </style>
</head>
<body>

    <header>
        <h1>AUNTY RANKING</h1>
        <p>The only validation that matters.</p>
    </header>

    <div id="home-page" class="page active">
        <h2>Select a Category to Judge:</h2>
        <div class="brutalist-card flex-row">
            <div>
                <h3>üéì Universities</h3>
                <p>From "Harvard of the East" to "Why did you waste money?"</p>
            </div>
            <button class="btn" onclick="showPage('uni-page')">VIEW RANKINGS</button>
        </div>
        <div class="brutalist-card flex-row">
            <div>
                <h3>üíº Career Paths</h3>
                <p>Doctor, Engineer, or ""</p>
            </div>
            <button class="btn">LOCKED</button>
        </div>
    </div>

    <div id="uni-page" class="page">
        <button class="btn btn-back" onclick="showPage('home-page')">‚Üê BACK TO HOME</button>
        <h2>University Leaderboard</h2>
        <div id="loading-text" style="display:none;">Asking the neighborhood aunties...</div>
        <div id="uni-list"></div>
    </div>

    <script>
        // --- CONFIGURATION ---
        // FIXED: Added quotes around the URL and Key
        const SUPABASE_URL = 'https://spyihezjhbfewcelenhn.supabase.co'; 
        const SUPABASE_KEY = 'sb_publishable_tWIdyqh4YRWRhomWt9MqKw_iu9_iy3m';
        const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        // --- DATA (Restored exactly as you had it) ---
        const localFallbackData = [
            { id: 1, name:"Bangladesh University of Engineering & Technology ", label: "PUBLIC", desc: "‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶õ‡ßá‡¶≤‡ßá BUET-‡¶è ‡¶™‡¶°‡¶º‡ßá.", votes: 1500 },
            { id: 2, name:"Dhaka Medical College ", label: "PUBLIC", desc: "‡¶¢‡¶æ‡¶ï‡¶æ ‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤, ‡¶∏‡¶∞‡¶ï‡¶æ‡¶∞‡¶ø ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá!.", votes: 420 },
            { id: 3, name:"Dhaka University", label: "PUBLIC", desc: "‡¶Ü‡¶ó‡ßá chance ‡¶™‡ßá‡¶Ø‡¶º‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ", votes: 100 },
            { id: 4, name:"Shahid Sahrawardy Medical College", label: "PUBLIC", desc: "‡¶Æ‡ßá‡¶°‡¶ø‡¶ï‡ßá‡¶≤......‡¶ì‡¶∏‡¶¨ ‡¶®‡¶æ‡¶Æ ‡¶ß‡¶∞‡ßá ‡¶≤‡¶æ‡¶≠ ‡¶ï‡¶ø, ‡¶°‡¶æ‡¶ï‡ßç‡¶§‡¶æ‡¶∞ ‡¶π‡¶≤‡ßá‡¶á ‡¶π‡¶≤‡ßã‡•§", votes: -85 },
            { id: 5, name:"Khulna University of Engineering & Technology", label: "PUBLIC", desc: "BUET ‡¶è ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ‡¶á, ‡¶®‡¶æ?'", votes: -85 },
            { id: 6, name:"Jahangirnagar University", label: "PUBLIC", desc: "‡¶ö‡¶æ‡¶ï‡¶∞‡¶ø ‡¶™‡¶æ‡¶¨‡¶æ  ‡¶§‡ßã ‡¶¨‡¶æ‡¶¨‡¶æ?", votes: -85 },
            { id: 7, name:"BRAC", label: "PRIVATE", desc: "‡¶Ü‡¶∏‡¶≤‡ßá ‡¶ì ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶§‡ßã, ‡¶ì ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ IELTS ‡¶ì ‡¶¶‡¶ø‡¶ö‡ßç‡¶õ‡ßá", votes: -85 },
            { id: 8, name:"IBA", label: "PUBLIC+PRIVATE", desc: "‡¶è‡¶á‡¶ü‡¶æ ‡¶ï‡¶ø Private ‡¶®‡¶æ, ‡¶≠‡¶æ‡¶¨‡¶ø?", votes: -85 },
            { id: 9, name:"North South University", label: "NOSHTO", desc: "Public ‡¶è ‡¶π‡¶Ø‡¶º ‡¶®‡¶æ‡¶á, ‡¶®‡¶æ?", votes: -85 },
            { id: 10,name:"AIUB", label: "IUB?", desc: "‡¶è‡¶á‡¶ü‡¶æ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶ø?", votes: -85 },
            { id: 11,name:"IUB", label: "AIUB?", desc: "North South ‡¶è‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá‡¶∞ University", votes: -85 },
            { id: 12,name:"MIST", label: "PUBLIC?", desc: "‡¶Ü‡¶∞‡ßç‡¶Æ‡¶ø‡¶∞ ‡¶Ü‡¶®‡ßç‡¶°‡¶æ‡¶∞‡ßá‡¶á'", votes: -85 },
            { id: 13,name:"Armed Forces Medical College", label: "ARMY DADDY", desc: "", votes: -85 },
            { id: 14,name:"BUP", label: "PRIVATE?", desc: "‡¶®‡¶æ, ‡¶Æ‡¶æ‡¶®‡ßá‚Ä¶ ‡¶™‡¶°‡¶º‡¶æ‡¶∂‡ßã‡¶®‡¶æ ‡¶ï‡¶∞‡ßá‡•§ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶ñ‡ßÅ‡¶¨ ‡¶°‡¶ø‡¶∏‡¶ø‡¶™‡ßç‡¶≤‡¶ø‡¶®‡•§", votes: -85 },
            { id: 15,name:"7 College", label: "KASHEMPUR", desc: "........................", votes: -85 }
        ];

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if(pageId === 'uni-page') fetchRankings();
        }

        async function fetchRankings() {
            const list = document.getElementById('uni-list');
            const loader = document.getElementById('loading-text');
            loader.style.display = 'block';
            
            try {
                const { data, error } = await supabaseClient
                    .from('rankings')
                    .select('*')
                    .order('votes', { ascending: false });

                loader.style.display = 'none';

                if (error) {
                    console.warn('Supabase error, using local data:', error.message);
                    renderUnis(localFallbackData);
                } else {
                    renderUnis(data);
                }
            } catch (err) {
                console.error('Fetch failed:', err);
                renderUnis(localFallbackData);
            }
        }

        function renderUnis(uniData) {
            const list = document.getElementById('uni-list');
            list.innerHTML = '';
            
            // Sort data by votes descending
            uniData.sort((a, b) => b.votes - a.votes).forEach(u => {
                const card = document.createElement('div');
                card.className = 'brutalist-card flex-row';
                card.innerHTML = `
                    <div>
                        <span class="tag">${u.label}</span>
                        <h3>${u.name}</h3>
                        <p>${u.desc || u.description}</p>
                    </div>
                    <div style="text-align: center">
                        <div style="font-size:1.5rem; font-weight:900">${u.votes}</div>
                        <button class="btn" onclick="vote(${u.id})">JUDGE</button>
                    </div>
                `;
                list.appendChild(card);
            });
        }

        async function vote(id) {
            const { error } = await supabaseClient.rpc('increment_vote', { row_id: id });
            if (error) {
                console.error("Vote error:", error);
                alert("Please make sure you've enabled RLS and set up the SQL function in Supabase!");
            } else {
                fetchRankings();
            }
        }
    </script>
</body>
</html>
